{"version":3,"sources":["../../src/middlewares/sellerVerificatiuon.middleware.ts"],"sourcesContent":["import { NextFunction, Response } from 'express';\r\nimport { verify } from 'jsonwebtoken';\r\nimport { SECRET_KEY } from '@config';\r\nimport { HttpException } from '@exceptions/HttpException';\r\nimport { DataStoredInToken, RequestWithUser } from '@interfaces/auth.interface';\r\nimport { initializeDbConnection } from '@/app';\r\n\r\nconst authMiddleware = async (req: RequestWithUser, res: Response, next: NextFunction) => {\r\n  try {\r\n    const isSellerVerifiedSession = initializeDbConnection().session();\r\n    const userId = String(req.params.id);\r\n    if (userId) {\r\n      const isSellerVerified = await isSellerVerifiedSession.executeRead(tx =>\r\n        tx.run('match (u:user {u:user userId: $userId}-[:IS_A]-(s:seller) return s', {\r\n          userId: userId,\r\n        }),\r\n      );\r\n\r\n      if (isSellerVerified.records.map(record => record.get(\"s\").properties.verified)) {\r\n        req.data.user = isSellerVerified.records.map(record => record.get(\"s\").properties)[0]\r\n        next();\r\n      } else {\r\n        next(new HttpException(401, 'this user is not verified yet'));\r\n      }\r\n    } else {\r\n      next(new HttpException(404, 'user id needed'));\r\n    }\r\n  } catch (error) {\r\n    next(new HttpException(401, error));\r\n  }\r\n};\r\n\r\nexport default authMiddleware;\r\n"],"names":["authMiddleware","req","res","next","isSellerVerifiedSession","initializeDbConnection","session","userId","String","params","id","isSellerVerified","executeRead","tx","run","records","map","record","get","properties","verified","data","user","HttpException","error"],"mappings":";;;;+BAgCA;;;eAAA;;;+BA7B8B;qBAES;AAEvC,MAAMA,iBAAiB,OAAOC,KAAsBC,KAAeC;IACjE,IAAI;QACF,MAAMC,0BAA0BC,IAAAA,2BAAsB,IAAGC,OAAO;QAChE,MAAMC,SAASC,OAAOP,IAAIQ,MAAM,CAACC,EAAE;QACnC,IAAIH,QAAQ;YACV,MAAMI,mBAAmB,MAAMP,wBAAwBQ,WAAW,CAACC,CAAAA,KACjEA,GAAGC,GAAG,CAAC,sEAAsE;oBAC3EP,QAAQA;gBACV;YAGF,IAAII,iBAAiBI,OAAO,CAACC,GAAG,CAACC,CAAAA,SAAUA,OAAOC,GAAG,CAAC,KAAKC,UAAU,CAACC,QAAQ,GAAG;gBAC/EnB,IAAIoB,IAAI,CAACC,IAAI,GAAGX,iBAAiBI,OAAO,CAACC,GAAG,CAACC,CAAAA,SAAUA,OAAOC,GAAG,CAAC,KAAKC,UAAU,CAAC,CAAC,EAAE;gBACrFhB;YACF,OAAO;gBACLA,KAAK,IAAIoB,4BAAa,CAAC,KAAK;YAC9B;QACF,OAAO;YACLpB,KAAK,IAAIoB,4BAAa,CAAC,KAAK;QAC9B;IACF,EAAE,OAAOC,OAAO;QACdrB,KAAK,IAAIoB,4BAAa,CAAC,KAAKC;IAC9B;AACF;MAEA,WAAexB"}