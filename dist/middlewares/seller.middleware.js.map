{"version":3,"sources":["../../src/middlewares/seller.middleware.ts"],"sourcesContent":["import { NextFunction, Response } from 'express';\r\nimport { verify } from 'jsonwebtoken';\r\nimport { SECRET_KEY } from '@config';\r\nimport { HttpException } from '@exceptions/HttpException';\r\nimport { DataStoredInToken, RequestWithUser } from '@interfaces/auth.interface';\r\nimport { initializeDbConnection } from '@/app';\r\nimport { RolesEnum } from '@/enums/RolesEnums';\r\n\r\nconst sellerMiddleware = async (req: RequestWithUser, res: Response, next: NextFunction) => {\r\n  const userId = String(req.params.id);\r\n  \r\n\r\n  const isVerifiedSession = initializeDbConnection().session();\r\n\r\n  try {\r\n    var isVerifiedUser = await isVerifiedSession.executeRead(\r\n      tx => tx.run(\"match (u:user {id: $userId})-[:IS_A]-(s:seller) return u, s\", {\r\n        userId: userId\r\n      })\r\n    )\r\n\r\n    console.log(isVerifiedUser.records.map(record => record.get(\"u\").properties.verified)[0]);\r\n    \r\n  \r\n    if (isVerifiedUser.records.map(record => record.get(\"s\")).length > 0) {\r\n      if(isVerifiedUser.records.map(record => record.get(\"s\").properties.isVerified)[0]){\r\n        next();\r\n      } else {\r\n        next(new HttpException(400, 'this user is not verified yet'));\r\n      }\r\n    } else {\r\n      next(new HttpException(400, 'this user is not a seller'));\r\n    }\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n};\r\n\r\nexport default sellerMiddleware;\r\n"],"names":["sellerMiddleware","req","res","next","userId","String","params","id","isVerifiedSession","initializeDbConnection","session","isVerifiedUser","executeRead","tx","run","console","log","records","map","record","get","properties","verified","length","isVerified","HttpException","error"],"mappings":";;;;+BAsCA;;;eAAA;;;+BAnC8B;qBAES;AAGvC,MAAMA,mBAAmB,OAAOC,KAAsBC,KAAeC;IACnE,MAAMC,SAASC,OAAOJ,IAAIK,MAAM,CAACC,EAAE;IAGnC,MAAMC,oBAAoBC,IAAAA,2BAAsB,IAAGC,OAAO;IAE1D,IAAI;QACF,IAAIC,iBAAiB,MAAMH,kBAAkBI,WAAW,CACtDC,CAAAA,KAAMA,GAAGC,GAAG,CAAC,+DAA+D;gBAC1EV,QAAQA;YACV;QAGFW,QAAQC,GAAG,CAACL,eAAeM,OAAO,CAACC,GAAG,CAACC,CAAAA,SAAUA,OAAOC,GAAG,CAAC,KAAKC,UAAU,CAACC,QAAQ,CAAC,CAAC,EAAE;QAGxF,IAAIX,eAAeM,OAAO,CAACC,GAAG,CAACC,CAAAA,SAAUA,OAAOC,GAAG,CAAC,MAAMG,MAAM,GAAG,GAAG;YACpE,IAAGZ,eAAeM,OAAO,CAACC,GAAG,CAACC,CAAAA,SAAUA,OAAOC,GAAG,CAAC,KAAKC,UAAU,CAACG,UAAU,CAAC,CAAC,EAAE,EAAC;gBAChFrB;YACF,OAAO;gBACLA,KAAK,IAAIsB,4BAAa,CAAC,KAAK;YAC9B;QACF,OAAO;YACLtB,KAAK,IAAIsB,4BAAa,CAAC,KAAK;QAC9B;IACF,EAAE,OAAOC,OAAO;QACdX,QAAQC,GAAG,CAACU;IACd;AACF;MAEA,WAAe1B"}